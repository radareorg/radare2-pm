R2PM_BEGIN

R2PM_GIT "https://github.com/radareorg/r2ghidra"
R2PM_DESC "Ghidra Disassembler, Analysis and Decompiler Plugins"

R2PM_DOC=""

R2PM_INSTALL_WINDOWS() {
	cd dist/windows/r2pm
	install.bat
}
R2PM_UNINSTALL_WINDOWS() {
	cd dist/windows/r2pm
	uninstall.bat
}

R2PM_INSTALL() {
	rm -rf ghidra/ghidra/Ghidra
	rm -rf build # clean build
	./preconfigure || exit 1
	./configure --prefix=`r2 -H R2_PREFIX` || R2PM_FAIL "configure"
	${MAKE} -C src -j1 || R2PM_FAIL "make"
	${MAKE} -C ghidra sleigh-build -j1 || R2PM_FAIL "make"
	if [ "${GLOBAL}" = 1 ]; then
		${SUDO} ${MAKE} -C src install
		${SUDO} ${MAKE} -C ghidra install
	else
		${MAKE} -C src user-install
		${MAKE} -C ghidra user-install
	fi
}

R2PM_UNINSTALL() {
	if [ "${GLOBAL}" = 1 ]; then
		${SUDO} ${MAKE} -C src uninstall
		${SUDO} ${MAKE} -C ghidra uninstall
	else
		${MAKE} -C src user-uninstall
		${MAKE} -C ghidra user-uninstall
	fi
}

R2PM_END
